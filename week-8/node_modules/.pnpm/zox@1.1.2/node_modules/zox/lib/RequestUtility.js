"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function contentTypeIsJson(request) {
    const contentType = request.headers['content-type'];
    return contentType.indexOf('application/json') == 0 ||
        contentType.indexOf('text/json') == 0;
}
exports.contentTypeIsJson = contentTypeIsJson;
function getContentLength(request) {
    if (typeof request.headers['content-length'] === 'string') {
        const contentLength = Number(request.headers['content-length']);
        return isNaN(contentLength) ? -1 : contentLength;
    }
    return -1;
}
exports.getContentLength = getContentLength;
function getRequestBody(request, parse, maxLength) {
    maxLength = maxLength || (1024 * 1024);
    let length = 0;
    const bodyChunks = [];
    return new Promise((resolve, reject) => {
        request
            .on('data', (chunk) => {
            length += chunk.length;
            if (length > maxLength) {
                request.connection.destroy();
            }
            else {
                bodyChunks.push(chunk);
            }
        })
            .on('end', () => {
            const body = Buffer.concat(bodyChunks);
            if (parse === 'json') {
                try {
                    resolve(JSON.parse(body.toString()));
                }
                catch (e) {
                    reject(e);
                }
            }
            else if (parse === 'string') {
                resolve(body.toString());
            }
            else {
                resolve(body);
            }
        })
            .on('error', e => reject(e));
    });
}
exports.getRequestBody = getRequestBody;
//# sourceMappingURL=RequestUtility.js.map